<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Mapa offline z markerem</title>
<style>
  #map {
    width: 768px;   /* 3 kafelki x 256px */
    height: 768px;  /* 3 kafelki x 256px */
    position: relative;
    border: 1px solid #333;
    overflow: hidden;
  }
  .tile {
    position: absolute;
    width: 256px;
    height: 256px;
  }
  #marker {
    position: absolute;
    width: 32px;
    height: 32px;
    background: url('marker.png') no-repeat center center;
    background-size: contain;
    pointer-events: none;
  }
</style>
</head>
<body>

<div id="map">
  <img id="tile00" class="tile" style="top:0;left:0" />
  <img id="tile01" class="tile" style="top:0;left:256px" />
  <img id="tile02" class="tile" style="top:0;left:512px" />
  <img id="tile10" class="tile" style="top:256px;left:0" />
  <img id="tile11" class="tile" style="top:256px;left:256px" />
  <img id="tile12" class="tile" style="top:256px;left:512px" />
  <img id="tile20" class="tile" style="top:512px;left:0" />
  <img id="tile21" class="tile" style="top:512px;left:256px" />
  <img id="tile22" class="tile" style="top:512px;left:512px" />
  <div id="marker"></div>
</div>

<script>
  // ---- STAŁA LOKALIZACJA ----
  const lat = 52.2297;    // szerokość
  const lon = 21.0122;    // długość
  const zoom = 16;        // poziom zoom
  const tileSize = 256;   // rozmiar kafelka

  // Funkcja lat/lon -> numer kafelka
  function deg2num(lat_deg, lon_deg, zoom) {
      const lat_rad = lat_deg * Math.PI / 180;
      const n = 2 ** zoom;
      const x = Math.floor((lon_deg + 180) / 360 * n);
      const y = Math.floor((1 - Math.log(Math.tan(lat_rad) + 1/Math.cos(lat_rad))/Math.PI)/2 * n);
      return {x, y};
  }

  const tile = deg2num(lat, lon, zoom);

  // Wyświetlamy 3x3 kafelki
  const ids = [
    ['tile00','tile01','tile02'],
    ['tile10','tile11','tile12'],
    ['tile20','tile21','tile22']
  ];

  for (let dy=-1; dy<=1; dy++) {
    for (let dx=-1; dx<=1; dx++) {
      const id = ids[dy+1][dx+1];
      const x = tile.x + dx;
      const y = tile.y + dy;
      document.getElementById(id).src = `tiles/${zoom}/${x}/${y}.png`;
    }
  }

  // Wyliczamy dokładną pozycję markera w pikselach kontenera 3x3
  const n = 2 ** zoom;
  const lonX = (lon + 180) / 360 * n;
  const latY = (1 - Math.log(Math.tan(lat*Math.PI/180)+1/Math.cos(lat*Math.PI/180))/Math.PI) / 2 * n;

  const pixelX = (lonX - (tile.x - 1)) * tileSize;  // uwzględnia lewy górny kafelek
  const pixelY = (latY - (tile.y - 1)) * tileSize;

  const marker = document.getElementById('marker');
  marker.style.left = `${pixelX - 16}px`;  // 16 = połowa szerokości markera
  marker.style.top = `${pixelY - 32}px`;   // 32 = wysokość markera
</script>

</body>
</html>
